:doctype: book
:compat-mode:
:page-layout!:
:toc: right
:toclevels: 2
:sectanchors:
:sectlinks:
:sectnums:
:linkattrs:
:icons: font
:source-highlighter: coderay
:source-language: asciidoc
:experimental:
:stem:
:idprefix:
:idseparator: -
:ast: &ast;
:dagger: pass:normal[^&dagger;^]
:y: icon:check[role="green"]
:n: icon:times[role="red"]
:c: icon:file-text-o[role="blue"]
:table-caption!:
:example-caption!:
:figure-caption!:
:imagesdir: images
:includedir: _includes
:underscore: _
:icons: font


= MCP Management Portal - User Guide

[[purpose-of-the-user-guide]]
== Purpose of the User Guide
The purpose of this User Guide is to give instructions on how to operate the MCP Management Portal (Previously the Maritime Cloud Management Portal). The reader is expected to be familiar with the concepts of MCP. For more information about MCP, please visit the official homepage: http://maritimeconnectivityplatform.net

[[general-focus-of-the-mcp-management-portal]]
== General focus of the MCP Management Portal

Everything in the MCP Management Portal is centered around the organization of the logged in user. +
Every entity in the Identity Registry section, only has data for the users own organization. +
An organization’s own entities: Vessels, Devices, Users, and Certificates are considered private and will never be shown to others. However, the Service Registry section has the possibility to show data for services of all organizations. Services for other organizations are always in read-only mode though and will never show Certificates - regardless of the user’s administrative rights.

[[icons-and-colors-in-the-mcp-management-portal]]
=== Icons and colors in the MCP Management Portal

Icons and colors in the MCP Management Portal follow the standard in the table:

[cols=",",options="header",]
|======================================================================================================================================================================================================
|Icon and color |Function
|image:image1.png[image,width=76,height=44] |Input field with validation not OK
|image:image2.png[image,width=75,height=46] |Input field with validation OK
|image:image3.png[image,width=86,height=48] |White button: Cancel or OK will always close the view and go back
|image:image4.png[image,width=112,height=37] |Blue button: "Safe" button - no changes of the data in the Service- or Identity registry. A new page will be shown with the given functionality
|image:image5.png[image,width=112,height=37] |Red button: "Unsafe" button - changes will be submitted to the data in the Service- or Identity registry
|======================================================================================================================================================================================================
[[not-yet-implemented]]
== Not yet implemented

The Management Portal is still in early beta; thus many features are not yet implemented. If a section in this guide is "not yet implemented", but is needed or wanted, (e.g. deletion of services) please file an issue at the https://github.com/MaritimeCloud/MaritimeCloudPortal/issues[Github project].

[[mrn-maritime-resource-name]]
== MRN - Maritime Resource Name

Every entity in the Maritime Connectivity Platform requires an MRN. For entities in the Identity Registry (e.g. Vessels) the MRN is autogenerated following the mask: +
_urn:mrn:<mcl|stm>:<entity-type>:<org-shortname>:<entityID>_

Example for a vessel from DMA:__ +
urn:mrn:mcl:vessel:dma:imo12345__

For entities in the Service Registry the MRN is not autogenerated, because it’s part of the XML that is uploaded when creating or updating Services on all levels (Specification, Technical Design, Instance). The MRN will be validated though. It needs to follow the mask: +
_urn:mrn:<mcl|stm>:service:<service-level>:<org-shortname>:<serviceID>_

Example for a service specification, technical design, instance from DMA respectively:__ +
urn:mrn:mcl:service:specification:dma:nw-nm +
urn:mrn:mcl:service:design:dma:nw-nm-rest +
urn:mrn:mcl:service:instance:dma:nw-nm-rest-1__

[[login]]
== Login

The MCP Management Portal for the **production environment** can be reached at https://management.maritimecloud.net

[[join-MCP-and-get-access-to-the-mcp-management-portal]]
=== Join MCP and get access to the MCP Management Portal

To get access to the MCP Management Portal your organization must be enrolled in MCP by a person who holds the legal rights to act on behalf of the organization. Please follow the "__Join__" link on the MCP Management Portal login page to fill out the application form. The organization will be validated and approved by a MCP governance organization, after which the applying organization will get access to the MCP Management Portal.

In the test period in the EfficienSea2 and STM Validation project, the governing organization will be the Danish Maritime Authority.

[[login-when-my-organization-is-federated-into-mcp]]
=== Login when my organization is federated into MCP

When your organization is federated into MCP, you can use your normal organization login (probably your Windows login).

Choose your organization in the list and you will be redirected to your organization’s federated login page.

image:broker-login-marked-idps.png[image,width=628,height=333]

Once you have logged in with your organization login you will be redirected back to the MCP Management Portal with access.

[[login-when-my-organization-is-part-of-the-project-test-phase-projecttestusers]]
=== Login when my organization is part of the Project test phase (ProjectTestUsers)

When your organization is not federated, you will get access through the EfficienSea2 and STM Validation project test users.

image:broker-login-marked-ptu.png[image,width=628,height=333]

Choose the "__ProjectTestUsers__" and provide your login information in the next page.

image:image8.png[image,width=437,height=243]

You will be redirected to the MCP Management Portal with access.

=== Login to the Test environment

When using the test environment (the MCP Management Portal for the test environment can be reached at https://test-management.maritimecloud.net) you can login using the same user as when you log into the production environment. To do this choose the "__MC-production__" Identity Provider when logging in.

image:test-broker-login-marked-mc-production.png[image,width=628,height=325]

This will redirect you to the login of the production environment, and you can then login as described in <<login-when-my-organization-is-federated-into-the-maritime-cloud>> or <<login-when-my-organization-is-part-of-the-project-test-phase-projecttestusers>>.

[[access-roles]]
=== Access Roles

The MCP Management Portal currently has 2 different roles. Administrator with full editorial rights (for own organization only) and Member with read-only rights.

The intention is to implement a finer grained access roles - for example, admin roles for only the Identity Registry and only the Service Registry etc.

[[managing-the-identity-registry]]
== Managing the Identity Registry

The entities in your organizations Identity Registry can be found in the menu.

image:image9.png[image,width=161,height=385]

The following subsections will explain how each entity is managed.

[[my-organization]]
=== My Organization

This is the "home" of the MCP Management Portal. Here you can find various information about your own organization, like contact info, certificates (for organization level), Access Roles, etc.

[[update-contact-information]]
==== Update contact information

To update the contact information of your organization, click the "__Update__" button on the "__My Organization__" page.

image:image10.png[image,width=617,height=582]

Make the changes and click "Update organization".

image:image11.png[image,width=498,height=672]

[[change-logo]]
==== Change logo

You can change the logo of your organization. The logo is only used in the list of organizations, which every user of the MCP Management Portal can see. Should no logo be uploaded, a default logo will be displayed.

image:image12.png[image,width=766,height=285]

To upload a new logo, click on the logo on the "__My Organization__" page and browse to the new logo.

image:image13.png[image,width=397,height=301]

[[access-roles-1]]
==== Access Roles

Not yet implemented.

[[identity-provider-information]]
==== Identity Provider information

Not yet implemented.

[[vessels-devices]]
=== Vessels & Devices

The management of Vessels and Devices is handled in the same way. Therefore, the examples in this section apply for both.

Note: the only reason for creating Vessels and Devices is if you need a certificate for the Vessel or Device concerned. Read more about management of certificates in the section <<certificates>>.

[[create]]
==== Create

To create a Vessel or Device, click the "+" in the list.

image:image14.png[image,width=469,height=425]

Fill out the form and click "__Register Device/Vessel__". The "__Permissions__" field is explained in depth in the <<permissions>> section of this guide.

image:image15.png[image,width=444,height=402]

[[update]]
==== Update

To create a Vessel or Device, choose it in the list and click the "__Update__" button on the details page.

image:image16.png[image,width=441,height=449]

image:image17.png[image,width=551,height=241]

Make the changes and click "Update device".

image:image18.png[image,width=553,height=351]

[[delete]]
==== Delete

Warning: If you delete an entity, all issued certificates will be revoked and become invalid.

To delete click the "Delete" button on the entity you want to delete.

image:image19.png[image,width=493,height=248]

[[users]]
=== Users

"Users" in this context refers to human users. Users can authenticate using the Openid Connect Identity Provider, or use a certificate issued by MCP.

[[create-1]]
==== Create

If an organization is federated into MCP, you do not need to create users! +
The users will automatically be created the first time they log in on a webpage that uses MCP, such as the MCP Management Portal.

If an organization is not federated into MCP and is using the "__ProjectTestUsers__" Identity Provider, users must be created manually in the Management Portal. When the user has been created, he/she will receive an email with instructions for how to log in with a temporary password.

[[update-1]]
==== Update

When an organization is federated into MCP, _users are automatically created and updated_ when they log in on a webpage that uses MCP, such as the MC Management Portal.

In the case that an organization is not federated into MCP, but is using the "__ProjectTestUsers__" Identity Provider, users must be updated manually in the Management Portal. +
Updating the password of a user cannot be done in the portal, this must be done from the "__ProjectTestUsers__" Identity Provider.

[[delete-1]]
==== Delete

For organizations, which is federated into MCP, users are automatically created or updated when they log in on a webpage that uses MCP, such as the MCP Management Portal. Therefore, deleting users does not make much sense for federated organizations, unless it is necessary to clean up the user list, or to remove all the users’ certificates.

If an organization is not federated into MCP and is using the "__ProjectTestUsers__" Identity Provider, users can be deleted from the portal. This will also remove the user from the "__ProjectTestUsers__" Identity Provider. The user will no longer be able to log in to access MCP services.

_When a user is deleted all of the user’s certificates are revoked._

[[permissions]]
=== Permissions

"Permissions" is a field which service providers can use to implement a method of access control (authorization) in their services. As an example, an organization could wish to grant extended access to a service for all their pilots from a single point of control. The permissions field is a way to facilitate this.

For a more thorough explanation and example, please refer to the http://developers.maritimecloud.net/identity/index.html#authorization[online documentation for authorization in MCP.]

[[certificates]]
=== Certificates

Certificates can be issued on all entities in MCP (e.g. Devices, Vessels, Users, Organizations, Services). For a better understanding of how certificates is used in MCP and which parameters is included, please refer to the http://developers.maritimecloud.net/identity/index.html#pki-and-x-509-certificates[online documentation].

[[information-in-the-certificate]]
==== Information in the certificate

In the certificate, there are several information’s about the entity. Please refer to the http://developers.maritimecloud.net/identity/index.html#certificate-attributes[online documentation].

[[issuing-a-certificate]]
==== Issuing a certificate

On every entity details page, there is a certificate section. This section is the same component for all entities. Therefore, the description and examples applies for all.

To issue a new certificate, click on the "__Issue new Certificate__" button.

image:image20.png[image,width=385,height=388]

Click on "__Issue Certificate__".

image:image21.png[image,width=369,height=213]

And that is it. A certificate has been issued and is ready for download.

image:image22.png[image,width=374,height=148]

__NOTE__: It is very important that you download the certificate, because it is the only time, that you can download the public- and private key.


==== Converting the certificate to a different format

The issued certificate is supplied in PEM (also known as PKCS #8) format, but it can easily be converted into other formats. There are several tools available that can do this, but we will recommend http://keystore-explorer.org[KeyStore Explorer] which is a free, crossplatform and userfriendly tool. If you download, install and run KeyStore Explorer you will see this screen:

image:keystore-explorer-start.png[]

Click the "__Create a new KeyStore__" marked with the red circle. This will open a window that will let you choose the type of the new keystore. In this case we will choose JKS, which is normally used for Java applications, but you can choose a different format if needed.

image:keystore-explorer-new-keystore-type.png[]

You have now created an empty keystore, and now the issued client certificate must be imported into the keystore. Click the "__Import Key Pair__" icon marked with a red circle:

image:keystore-explorer-empty-keystore.png[]

Now choose the type of the key pair to import, in this case "__PKCS #8__".

image:keystore-explorer-key-pair-type.png[]

In the new window you should click browse and choose the files for the Private Key and Certificate, respectively. Note that the "__Encrypted Private Key__" checkbox should be unchecked and the "__Decryption Password__" field should be empty.

image:keystore-explorer-select-key-pair.png[]

Now supply a key pair alias that will be used to find/identify the key pair in the keystore.

image:keystore-explorer-key-pair-alias.png[]

You will now have to enter a password for the imported keystore. This will be needed when extracting the certificate key pair from the new keystore.

image:keystore-explorer-key-pair-password.png[]

The key pair (private key and certificate) has now been loaded into the new keystore, and will be shown in the list. Click the "__Save__" icon to save the keystore to a file.

image:keystore-explorer-new-keystore-save1.png[]

You will know have to enter a password for the keystore itself. This will be needed when opening the keystore later.

image:keystore-explorer-keystore-password.png[]

Now choose a location for your new keystore and press "__Save__".

image:keystore-explorer-new-keystore-save2.png[]

Then locate the keystore you saved, load it into your application and you should be ready to authenticate using your client certificate.

[[revoking-a-certificate]]
==== Revoking a certificate

When a certificate needs to be revoked, find the relevant user/vessel/device/service and the certificate that should be revoked at click on "__Revoke__".

image:certificate-revoke1.png[]

This will show a window where you will have to choose a reason and a date for the revocation in the selectors. Once these has been entered you can click "__Revoke__".

image:certificate-revoke2.png[]

The certificate will now have been revoked and the certificate will be marked as such in the certificate list.

image:certificate-revoke3.png[]

[[managing-the-service-registry]]
== Managing the Service Registry

The Service Registry consists of 3 levels:

* Specification: Technology-agnostic logical level (What)
* Technical Design: Technology level (How)
* Instance: The actual service implementation (Where)

For more information of the 3 levels and how they are connected, please refer to the online documentation at http://maritimeconnectivityplatform.net or the "__How To?__" page in the MCP Management Portal.

image:image23.png[image,width=784,height=399]

The following subsections will describe each level in the service registry and how to manage.

Note: At the moment, service data is shown for all organizations with no possibility to filter or search. In the future, there will be filtering and searching options. Service data for other organizations is always in read-only mode though and will never show Certificates - regardless of the user’s administrative rights.

[[services-specification]]
=== Services Specification

[[view-and-download]]
==== View and download

To view a Specification, click "__Specifications__" in the menu and a list of specifications appear. Click on any column of a row in the list to view that Specification.

image:image24.png[image,width=917,height=372]

In the details page, you can see a subset of the Specification data. To view all data, you can download the actual documents that were uploaded upon the registration of the Specification.

image:image25.png[image,width=591,height=232]

image:image26.png[image,width=595,height=234]

[[createregister]]
==== Create/Register

To register a new Specification, click "__Specifications__" in the menu and a list of specifications appear. Click the "__Register new Specification__" button at the bottom of the list.

image:image27.png[image,width=547,height=413]

Now you can upload 2 documents (see online documentation for templates of the documents):

* An XML-file following the official template with machine readable information. This is a required document
* A document in human readable format of the Specification. This is not required, but it is highly recommended to provide

When the XML-file is uploaded, there will be a validation of the Specification ID, which should be a MRN (refer to the <<mrn-maritime-resource-name>> section of this guide. An example MRN for DMA would be: _urn:mrn:mcl:service:specification:dma:nw-nm_

When all is uploaded correctly, click the "__Register Specification__" button.

image:image28.png[image,width=523,height=287]

[[update-2]]
==== Update

Not yet implemented.

[[delete-2]]
==== Delete

Not yet implemented.

[[service-technical-design]]
=== Service Technical Design

[[view-and-download-1]]
==== View and download

To view a Technical Design, click "__Designs__" in the menu and a list of Technical Designs appear. Click on any column of a row in the list to view that Design.

image:image29.png[image,width=910,height=337]

You can also get to the design by clicking any column of a row if you have a Specification in view.

image:image30.png[image,width=775,height=467]

In the details page, you can see a subset of the Technical Design data. To view all data, you can download the actual documents that were uploaded upon the registration of the Technical Design.

image:image31.png[image,width=782,height=322]

[[createregister-1]]
==== Create/Register

To register a new Technical Design, you need to select the Specification you want the Technical Design to implement. When the Specification is selected, you should click on the "__Register new Design__" at the Specification details page.

image:image32.png[image,width=815,height=393]

Now you can upload 2 documents (see online documentation for templates of the documents):

* An Xml-file following the official template with machine readable information. This is a required document
* A document in human readable format of the Technical Design. This is not required, but it is highly recommended to provide

When the XML-file is uploaded, there will be a validation of the Technical Design ID, which should be a MRN (refer to the <<mrn-maritime-resource-name>> section of this guide. An example MRN for DMA would be: _urn:mrn:mcl:service:design:dma:nw-nm_

When all is uploaded correctly, click the "__Register Design__" button.

image:image33.png[image,width=843,height=456]

[[update-3]]
==== Update

Not yet implemented.

[[delete-3]]
==== Delete

Not yet implemented.

[[service-instance]]
=== Service Instance

[[view-and-download-2]]
==== View and download

To view an Instance, click "__Instances__" in the menu and a list of Instances appear. Click on any column of a row in the list to view that Instance.

image:image34.png[image,width=903,height=337]

You can also get to the Instance by clicking any column of a row if you have a Technical Design in view.

image:image35.png[image,width=883,height=484]

In the details page, you can see a subset of the Instance data. To view all data, you can download the actual documents that were uploaded upon the registration of the Instance.

image:image36.png[image,width=771,height=325]

[[createregister-2]]
==== Create/Register

To register a new Instance, you need to select the Technical Design you want the Instance to implement. When the Technical Design is selected, you should click on the "__Register new Instance__" at the Technical Design details page.

image:image37.png[image,width=934,height=455]

Now you can upload 2 documents (see online documentation for templates of the documents):

* An XML-file following the official template with machine readable information. This is a required document
* A document in human readable format of the Instance. This is not required, but it is highly recommended to provide

When the XML-file is uploaded, there will be a validation of the Instance ID, which should be a MRN (refer to the <<mrn-maritime-resource-name>> section of this guide. An example MRN for DMA would be: _urn:mrn:mcl:service:instance:dma:nw-nm_

When all is uploaded correctly, you can provide additional information to the service if you should need to issue certificates for the service later. This includes the field "Certificate Domain Name", where you should enter the name of the domain where the service will be hosted (e.g. Service.dma.dk) and the field "Permissions" which will also be embedded in the certificate. Should this not be relevant for your service, simply leave the fields empty.

image:image38.png[image,width=521,height=710]

When everything is OK, click the "__Register Instance__" button.

[[update-4]]
==== Update

Not yet implemented

[[delete-4]]
==== Delete

Not yet implemented.

[[searching-the-service-registry]]
=== Searching the Service Registry

Not yet implemented.
